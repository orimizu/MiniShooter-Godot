# 弾幕系縦シューティング - Godot版

HTMLベースの弾幕シューティングゲームをGodot 4.4に移植したプロジェクトです。

## 概要

このプロジェクトは、元のHTMLファイル`shooting_20250531.html`に含まれていた弾幕系縦シューティングゲームを、Godot 4.4エンジンを使用して再実装したものです。

## ゲーム機能

### プレイヤー機能
- WASD/矢印キーでの移動
- スペースキーでの射撃
- Zキーでのボム（ライフ1消費で画面クリア）
- スコアに応じた弾数の増加システム
  - 500点以上：後方弾追加
  - 1000点以上：横方向弾追加
  - 2000点以上：斜め弾追加
  - 3000点以上：45度弾追加

### 敵機能
- 6種類の異なる色とパターン（赤、黄、シアン、青、緑、マゼンタ）
- 2色グラデーションによる詳細なピクセルアート
- 4つの移動パターン（直進、揺れ、斜め、バック）
- 16方向弾幕攻撃
- 青色の敵は速度変化特性
- 画面端での跳ね返り（左右方向のみ）

### ゲームシステム
- スコアシステム（敵の色に応じた得点：赤10点、黄20点、シアン30点、青25点、緑40点、マゼンタ50点）
- ライフシステム（最大5ライフ）
- ボムシステム（ライフ1消費で全画面クリア + 白フラッシュエフェクト）
- 敵出現率の動的調整（スコアに応じて段階的に増加）
- ゲームオーバー/リスタート機能

## プロジェクト構造

```
MiniShooting/
├── project.godot           # Godotプロジェクトファイル
├── icon.svg               # プロジェクトアイコン
├── scenes/                # シーンファイル
│   ├── Main.tscn         # メインゲームシーン
│   ├── Player.tscn       # プレイヤーシーン
│   ├── Enemy.tscn        # 敵シーン
│   ├── Bullet.tscn       # 弾丸シーン
│   └── DestroyEffect.tscn # 撃破エフェクトシーン
├── scripts/               # スクリプトファイル
│   ├── GameManager.gd    # ゲーム全体の管理
│   ├── UIManager.gd      # UI管理
│   ├── Player.gd         # プレイヤー制御
│   ├── Enemy.gd          # 敵制御
│   ├── Bullet.gd         # 弾丸制御
│   ├── DestroyEffect.gd  # 撃破エフェクト制御
│   ├── SoundManager.gd   # サウンド管理
│   ├── HighScoreManager.gd # ハイスコア管理
│   └── StageManager.gd   # ステージ管理
├── CLAUDE.md             # AI開発ガイド
└── README.md             # このファイル
```

## 操作方法

- **移動**: WASD キーまたは矢印キー
- **射撃**: スペースキー
- **ボム**: Z キー（ライフ1消費、画面上の敵と敵弾を全削除）
- **ゲーム開始**: Start Game ボタン
- **リスタート**: Restart ボタン（ゲームオーバー時）

## 必要な環境

- Godot 4.4以上（推奨）
- OpenGL ES 3.0対応の環境

## 実行方法

1. Godot 4.4以上をインストール
2. プロジェクトフォルダを開く
3. `scenes/Main.tscn`をメインシーンとして実行
4. F5キーでゲーム開始

## 技術的特徴

### ピクセルアート描画
- すべてのスプライトは8x8ピクセルパターンをコードで描画
- `_draw()`関数を使用したカスタム描画システム
- 敵キャラクターは2色グラデーションによる詳細な表現

### 衝突システム
- Area2Dベースの移動システム（物理演算なし）
- 円形の当たり判定による高精度な衝突検出
- プレイヤー（半径1px）、敵（半径12px）、弾丸（半径4px）の最適化された当たり判定

### シグナルシステム
- 弾丸発射、敵撃破、スコア変更、ボム使用などのイベント通信
- 疎結合な設計による拡張性

### UI管理
- CanvasLayerベースのUI
- 動的なスコア・ライフ・ボム操作表示
- スタート画面・ゲームオーバー画面
- ボム使用時の全画面白フラッシュエフェクト
- 被弾時の赤フラッシュエフェクト
- 難易度表示（星マークで5段階表示）

### ビジュアルエフェクト
- 当たり判定可視化（プレイヤー中央に青い十字マーク、被弾時は赤）
- 敵撃破時のパーティクルエフェクト（敵の色に応じたカラフルな爆発）
- スコアポップアップ（撃破時に得点を表示）
- 画面振動エフェクト（被弾時にCamera2Dを使用）

### サウンドシステム
- プログラムで生成される4種類の効果音
- 射撃音：2000Hz、0.1秒、高音で短い音（音量8%）
- 敵撃破音：150Hz、0.2秒、爆発音風のノイズミックス
- 被弾音：30Hz、0.5秒、低音の重い音
- ボム音：50Hz、0.5秒、超低音の振動音
- 射撃音の重複防止（再生中は新しい音を開始しない）

## 元のHTMLからの変更点

1. **描画システム**: Canvas 2DからGodotの_draw()システムに移行、2色グラデーション対応
2. **移動システム**: 手動計算からArea2Dベースの位置制御に変更（物理演算無効）
3. **イベント処理**: DOM操作からシグナルシステムに移行
4. **ゲームループ**: requestAnimationFrameから_process()/_physics_process()に変更
5. **UI**: HTMLからGodotのUIノードシステムに移行
6. **衝突判定**: 距離計算からArea2D overlap検出に変更
7. **当たり判定**: より精密な円形判定（プレイヤー1px、敵12px、弾丸4px）
8. **ボムシステム**: 新機能追加 - 戦略的なライフ消費による画面クリア機能

## Phase 1 完了内容（基盤強化）

### 実装済み機能
1. **ゲームバランス調整**
   - ライフシステムを5に変更（当初20から調整）
   - 敵の色別体力と得点の実装
   - プレイヤー攻撃パターンの段階的解放（3→5→7→9方向）

2. **UI/UX改善**
   - 当たり判定可視化（青い十字マーク）
   - 難易度の視覚的表示（星マーク5段階）
   - 撃破エフェクトとスコアポップアップ
   - 被弾時の赤フラッシュと画面振動

3. **基本システム安定化**
   - オブジェクト削除の安全化（逆順ループ）
   - パフォーマンス最適化（衝突判定の効率化）
   - プログラム生成による音響効果の実装

## 開発について

このプロジェクトは、元のHTML/JavaScript実装の動作をできる限り忠実に再現することを目標としています。オリジナルの弾幕パターン、移動システム、プログレッション要素をすべてGodotで実装し、さらに以下の改善を加えています：

- ボムシステムによる戦略性の向上
- 視覚的フィードバックの強化
- サウンドシステムの実装
- より洗練されたゲームバランス

## Phase 2 前半完了内容（ゲーム性拡張）

### 実装済み機能

#### 1. ハイスコアシステム
- **ローカル保存**: 上位10位までのスコア記録（user://highscores.save）
- **専用画面**: タイトル画面とゲームオーバー画面からアクセス可能
- **視覚的ランキング**: 
  - 1位: ゴールド色
  - 2位: シルバー色
  - 3位: ブロンズ色
  - 4位以下: シアン色
- **新記録演出**: 点滅アニメーションとスケールエフェクト
- **記録保存タイミング**: 各ステージクリア時（将来の拡張に対応）

#### 2. ステージシステム
- **5ステージ構成**: 
  - Stage 1 - Green Fields（緑）: 基本ステージ
  - Stage 2 - Blue Ocean（青）: 速度重視
  - Stage 3 - Yellow Desert（黄）: 弾幕重視
  - Stage 4 - Red Volcano（赤）: バランス型
  - Stage 5 - Purple Void（紫）: 最高難易度
- **ステージ進行**: 各60秒間、55秒でボス出現予定（未実装）
- **背景色変化**: ステージごとに独自の背景色
- **敵出現パターン**: ステージ別の敵タイプ出現率調整
- **難易度倍率**: 1.0x → 2.0x まで段階的上昇
- **プログレスバー**: 
  - 画面上部に大型バー表示
  - ステージ色に対応した配色
  - 90%以上で警告点滅
- **クリア演出**: ゴールドテキストとフラッシュエフェクト

## ボムシステムの仕様

- **使用条件**: ライフが2以上の時のみ使用可能
- **効果**: 画面上のすべての敵と敵弾を瞬時に削除
- **コスト**: ライフを1消費
- **クールダウン**: 0.5秒間の連続使用防止
- **視覚効果**: 全画面白フラッシュエフェクト（0.2秒間）
- **戦略性**: ピンチ時の緊急回避手段として活用